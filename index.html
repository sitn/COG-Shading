<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COG Shading</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@9.1.0/ol.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="ol.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/suncalc@1.9.0/suncalc.min.js "></script>
    <script src="https://cdn.jsdelivr.net/npm/geotiff"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.6.2/proj4.js"></script>
</head>
<body>
    <div id="panelLeft">
        <div id="mapControls">
            <h2>Shading</h2>
            <div style="text-align: center;">
                <input id="userDate" type="datetime-local">
                <button id="playStopButton" style="padding:5px;margin-bottom:15px;">Play / Stop</button>
                <label>Speed</label><input id="animationSpeed" type="range" min="0" max="100" step="1">
            </div>
            <hr>
        </div>
        <button onclick="resetUI()">Reset</button>
        <hr>
        <div>
            <p>Cursor position :</p>
            <div id="cursorPosition"></div>
        </div>
    </div>
    <div id="map"></div>
    <script type="module">
        import ShadedOpenLayers from "./ShadedOpenLayers.js"

        const sliders = {
            // ID           Name           Min  Max Default  Unit
            "elevation"  : ["Sun elevation", 0,    90,  45, '°'],
            "azimuth"    : ["Sun azimuth",   0, 359.9,  45, '°'],
            "occlusion"  : ["Occlusion",     0,   1.1, 0.9,  ''],
            "shadow"     : ["Shadow",        0,     1, 0.5,  ''],
            "zFactor"    : ["Terrain Exaggeration",  0,     5,   1, 'x'],
            "brightness" : ["Brightness",  -0.75,     0.75,   0,  ''],
            "exposure"   : ["Exposure",     -1,     1,   0,  ''],
            "contrast"   : ["Contrast",     -1,     1,   0,  ''],
            "gamma"      : ["Gamma",         0,    10,   1,  ''],
            "dilation"   : ["dilation",      0,     3,   1,  ''],
        }

        const extent = [2485250,1109500, 2513250,1136000]
        const projection = "EPSG:2056"
        proj4.defs(projection, "+proj=somerc +lat_0=46.95240555555556 +lon_0=7.439583333333333 +k_0=1 +x_0=2600000 +y_0=1200000 +ellps=bessel +towgs84=674.374,15.056,405.346,0,0,0,0 +units=m +no_defs");
        ol.proj.proj4.register(proj4);

        const shadedOpenLayers = new ShadedOpenLayers({
            dem : 'https://sitn.ne.ch/services/cog/shading/sitg/mns2023_10cm_sitg_cog_full.tif',
            occlusion : 'https://sitn.ne.ch/services/cog/shading/sitg/ao_mns2023_10cm_sitg_highres_cog_full.tif',
            shadowMap : 'https://sitn.ne.ch/services/cog/shading/sitg/sm_mns2023_10cm_sitg_cog_full.tif',
        }, projection, extent, sliders)
        
        document.body.onload = () => shadedOpenLayers.start()
        document.getElementById("userDate").onchange = () => shadedOpenLayers.onUserDateChange()
        document.getElementById("animationSpeed").oninput = () => shadedOpenLayers.toggleAnimation();shadedOpenLayers.toggleAnimation();
        document.getElementById("playStopButton").onclick = () => shadedOpenLayers.toggleAnimation()
    </script>
</body>
</html>